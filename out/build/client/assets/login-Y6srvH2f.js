import{a as t,v as ae,q as te,x as re,w as le}from"./chunk-OIYGIGL5-BjQr_l_M.js";import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{u as ie}from"./auth-provider-Diczkjh1.js";import{S as m,M as _,F as j}from"./mail-C6USHQwt.js";import{s as $,g as z}from"./redirect-D7e2wz-9.js";import{A,a as I,E as oe,b as ne}from"./eye-DMWkklOV.js";import{B as d}from"./button-Lf--0ePE.js";import{C as G,a as P,b as ce,c as me,d as de,e as H}from"./card-CfdgI_6O.js";import{I as R}from"./input-B6_poRDs.js";import{C as b,L as N}from"./label-DlsFJCEv.js";import{c as K}from"./utils-BEHD0UYf.js";import{L as F,C as ue}from"./loader-circle-BLBYjE2T.js";import{L as he}from"./lock-Cn8RQiRM.js";import"./createLucideIcon-CwMMISn7.js";import"./index-yifceNX_.js";import"./index-B2a0W2do.js";import"./index-CpAFY4EY.js";function xe(l,u){const h=new URLSearchParams(u).toString();return`${l}${h?`?${h}`:""}`}function pe(){const[l,u]=t.useState(""),[n,h]=t.useState(""),[k,U]=t.useState(!1),[q,M]=t.useState(!1),[i,D]=t.useState(!1),[x,r]=t.useState(""),[p,f]=t.useState(""),[T,B]=t.useState(""),[v,w]=t.useState(!1),[g,E]=t.useState(""),[c,O]=t.useState(!1),[y,S]=t.useState(""),{signIn:X,resetPassword:Y,isAuthenticated:V,isLoading:C}=ie(),L=ae(),o=te();t.useEffect(()=>{const s=localStorage.getItem(m.rememberEmail);s&&(u(s),M(!0))},[]),t.useEffect(()=>{if(!C&&V){const s=$(z(o.search,o.state),"/rancho");L(s,{replace:!0})}},[V,C,L,o.search,o.state]);const J=s=>{const a=s.target.value;u(a),r(""),a&&!j.test(a)?f("Por favor, utilize um email institucional (@fab.mil.br)."):f("")},Q=s=>{h(s.target.value),r(""),S("")},W=s=>{const a=s.target.checked;M(a),a&&l&&j.test(l)?localStorage.setItem(m.rememberEmail,l):localStorage.removeItem(m.rememberEmail)},Z=async s=>{if(s.preventDefault(),!j.test(l)){f("O email fornecido não é um email válido da FAB.");return}if(n.length<6){r("A senha deve ter pelo menos 6 caracteres.");return}D(!0),r(""),f("");try{await X(l,n),q?localStorage.setItem(m.rememberEmail,l):localStorage.removeItem(m.rememberEmail);const a=$(z(o.search,o.state),"/rancho");L(a,{replace:!0})}catch(a){console.error("Falha no login:",a),a?.code==="INVALID_CREDENTIALS"?(S("Senha incorreta"),r("")):(r(a?.message||"Ocorreu um erro durante a autenticação. Tente mais tarde."),S(""))}finally{D(!1)}},ee=async s=>{if(s.preventDefault(),!j.test(g)){r("Por favor, insira um email válido da FAB.");return}O(!0),r("");try{await Y(g),B("Email de recuperação enviado! Verifique sua caixa de entrada."),w(!1),E("")}catch(a){console.error("Erro ao enviar email de recuperação:",a),r(a?.message||"Erro ao enviar email de recuperação. Tente novamente.")}finally{O(!1)}},se=xe("/register",o.search);return C?e.jsx(G,{className:"w-full max-w-md mx-auto",children:e.jsxs(P,{className:"flex items-center justify-center py-8",children:[e.jsx(F,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Verificando autenticação..."})]})}):e.jsxs(G,{className:"w-full max-w-md mx-auto",children:[e.jsxs(ce,{className:"space-y-1",children:[e.jsx(me,{className:"text-2xl text-center",children:v?"Recuperar Senha":"Entrar"}),e.jsx(de,{className:"text-center",children:v?"Digite seu email para receber instruções de recuperação":"Acesso restrito a emails @fab.mil.br"})]}),v?e.jsxs("form",{onSubmit:ee,children:[e.jsxs(P,{className:"space-y-4",children:[x&&e.jsxs(A,{variant:"destructive",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx(I,{children:x})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"resetEmail",children:"Email Institucional"}),e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(R,{id:"resetEmail",type:"email",placeholder:"seu.nome@fab.mil.br",value:g,onChange:s=>{E(s.target.value),r("")},className:"pl-10",required:!0,disabled:c,autoComplete:"email"})]})]})]}),e.jsxs(H,{className:"flex flex-col space-y-4",children:[e.jsxs(d,{type:"submit",className:"w-full my-6 py-3 text-lg font-semibold",disabled:c||!g,children:[c&&e.jsx(F,{className:"mr-2 h-4 w-4 animate-spin"}),c?"Enviando...":"Enviar Email de Recuperação"]}),e.jsx(d,{type:"button",variant:"outline",className:"w-full",onClick:()=>{w(!1),E(""),r("")},disabled:c,children:"Voltar ao Login"})]})]}):e.jsxs("form",{onSubmit:Z,children:[e.jsxs(P,{className:"space-y-4",children:[x&&e.jsxs(A,{variant:"destructive",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx(I,{children:x})]}),T&&e.jsxs(A,{className:"border-green-200 bg-green-50",children:[e.jsx(ue,{className:"h-4 w-4 text-green-600"}),e.jsx(I,{className:"text-green-800",children:T})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"email",children:"Email Institucional"}),e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(R,{id:"email",type:"email",placeholder:"seu.nome@fab.mil.br",value:l,onChange:J,className:K("pl-10",{"border-red-500 focus-visible:ring-red-500":p}),required:!0,disabled:i,autoComplete:"email"})]}),p&&e.jsxs("p",{className:"text-sm text-red-600 mt-1 flex items-center",children:[e.jsx(b,{className:"h-3 w-3 mr-1"}),p]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"password",children:"Senha"}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(R,{id:"password",type:k?"text":"password",placeholder:"••••••••",value:n,onChange:Q,className:K("pl-10 pr-10",{"border-red-500 focus-visible:ring-red-500":!!y}),required:!0,disabled:i,autoComplete:"current-password",minLength:6}),e.jsx(d,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>U(s=>!s),disabled:i,children:k?e.jsx(oe,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"})})]}),y&&e.jsxs("p",{className:"text-sm text-red-600 mt-1 flex items-center",children:[e.jsx(b,{className:"h-3 w-3 mr-1"}),y]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{id:"remember",type:"checkbox",checked:q,onChange:W,className:"rounded border-gray-300",disabled:i,title:"Lembrar email"}),e.jsx(N,{htmlFor:"remember",className:"text-sm font-normal",children:"Lembrar email"})]}),e.jsx(d,{type:"button",variant:"link",className:"px-0 font-normal text-sm",onClick:()=>{w(!0),r(""),B("")},disabled:i,children:"Esqueceu a senha?"})]})]}),e.jsxs(H,{className:"flex flex-col space-y-4",children:[e.jsxs(d,{type:"submit",className:"w-full my-6 py-3 text-lg font-semibold",disabled:i||!!p||!l||!n,children:[i&&e.jsx(F,{className:"mr-2 h-4 w-4 animate-spin"}),i?"Entrando...":"Entrar"]}),e.jsxs("p",{className:"text-sm text-center text-muted-foreground",children:["Não tem uma conta?"," ",e.jsx(re,{to:se,className:"text-primary hover:underline font-medium",children:"Cadastre-se"})]})]})]})]})}function ke({}){return[{title:"Login"},{name:"description",content:"Faça seu Login"}]}const qe=le(pe);export{qe as default,ke as meta};

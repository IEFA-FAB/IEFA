import{j as p}from"./jsx-runtime-D_zvdyIk.js";import{a as s}from"./chunk-OIYGIGL5-BjQr_l_M.js";function L(e){const u=e?.status,a=e?.message||"Erro de autenticação";return/invalid login credentials/i.test(a)?{code:"INVALID_CREDENTIALS",message:"Email ou senha incorretos"}:/email not confirmed/i.test(a)?{code:"EMAIL_NOT_CONFIRMED",message:"Por favor, confirme seu email antes de fazer login"}:/rate limit/i.test(a)||u===429?{code:"RATE_LIMITED",message:"Muitas tentativas. Aguarde um pouco e tente novamente."}:/invalid format/i.test(a)?{code:"INVALID_EMAIL",message:"Formato de email inválido"}:/at least 6 characters/i.test(a)?{code:"WEAK_PASSWORD",message:"A senha deve ter pelo menos 6 caracteres"}:/signup is disabled/i.test(a)?{code:"SIGNUP_DISABLED",message:"Cadastro temporariamente desabilitado"}:/user already registered/i.test(a)?{code:"ALREADY_REGISTERED",message:"Este email já está cadastrado"}:{code:"UNKNOWN",message:a}}function m(e){switch(e.message){case"Invalid login credentials":return"Email ou senha incorretos";case"Email not confirmed":return"Por favor, confirme seu email antes de fazer login";case"User already registered":return"Este email já está cadastrado";case"Password should be at least 6 characters":return"A senha deve ter pelo menos 6 caracteres";case"Unable to validate email address: invalid format":return"Formato de email inválido";case"Signup is disabled":return"Cadastro temporariamente desabilitado";default:return e.message}}const I=s.createContext(void 0);function f(e){return e.trim().toLowerCase()}function D({supabase:e,children:u}){const[a,S]=s.useState(null),[l,C]=s.useState(null),[h,g]=s.useState(!0),c=s.useRef(!0),i=s.useCallback(o=>{C(o),S(o?.user??null)},[]);s.useEffect(()=>{c.current=!0,(async()=>{try{const{data:r,error:t}=await e.auth.getSession();t&&console.error("Error getting initial session:",t),c.current&&i(r?.session??null)}catch(r){console.error("Error initializing auth:",r)}finally{c.current&&g(!1)}})();const{data:o}=e.auth.onAuthStateChange((r,t)=>{c.current&&(i(t??null),g(!1))});return()=>{c.current=!1,o.subscription.unsubscribe()}},[e,i]);const w=s.useCallback(async(o,r)=>{try{const{error:t}=await e.auth.signInWithPassword({email:f(o),password:r});if(t){const n=L(t),d=new Error(n.message);throw d.code=n.code,d.status=t?.status,d}}catch(t){throw t?.message?t:new Error("Não foi possível entrar. Tente novamente mais tarde.")}},[e]),E=s.useCallback(async(o,r,t)=>{try{const{error:n}=await e.auth.signUp({email:f(o),password:r,options:{emailRedirectTo:t??(typeof window<"u"?`${window.location.origin}/auth/callback`:void 0)}});if(n)throw new Error(m(n))}catch(n){throw n?.message?n:new Error("Não foi possível cadastrar. Tente novamente mais tarde.")}},[e]),v=s.useCallback(async o=>{try{i(null);const{error:r}=await e.auth.signOut();r&&console.error("Sign out error:",r)}catch(r){console.error("Sign out error:",r)}finally{o?.reload&&typeof window<"u"&&window.location.assign(o.redirectTo??"/login")}},[e,i]),A=s.useCallback(async(o,r)=>{try{const{error:t}=await e.auth.resetPasswordForEmail(f(o),{redirectTo:r??(typeof window<"u"?`${window.location.origin}/auth/reset-password`:void 0)});if(t)throw new Error(m(t))}catch(t){throw t?.message?t:new Error("Não foi possível iniciar a recuperação de senha.")}},[e]),y=s.useCallback(async()=>{const{data:o,error:r}=await e.auth.refreshSession();if(r)throw new Error(m(r));i(o?.session??null)},[e,i]),N=s.useMemo(()=>({user:a,session:l,isLoading:h,isAuthenticated:!!l?.user,signIn:w,signUp:E,signOut:v,resetPassword:A,refreshSession:y}),[a,l,h,w,E,v,A,y]);return p.jsx(I.Provider,{value:N,children:u})}const T=()=>{const e=s.useContext(I);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e};export{D as A,T as u};

import{a as d,w as Xe,t as Je}from"./chunk-OIYGIGL5-BjQr_l_M.js";import{j as a}from"./jsx-runtime-D_zvdyIk.js";import{_ as et,s as O}from"./supabase-BHBWl_Zr.js";import{b as Ne,B as A}from"./button-Lf--0ePE.js";import{L as ae,C as G}from"./label-DlsFJCEv.js";import{T as tt,a as at,b as ee,c as F,d as st,e as I,S as rt}from"./table-C7VMFkZa.js";import{t as j}from"./index-BRsIKSDg.js";import{B as V}from"./badge-B95kivET.js";import{a as ve,b as ye,c as xe,d as we,S as _e}from"./useMessHalls-DOz8GpeU.js";import{U as it}from"./MessHallSelector-Ddc9UKgG.js";import{f as K,U as nt}from"./RanchoUtils-CDHCvR11.js";import{C as ot}from"./calendar-xf6wNq1b.js";import{C as je}from"./check-P3aSJU2R.js";import{c as ct,e as lt}from"./index-BsqcEdqH.js";import{u as be,a as dt}from"./index-yifceNX_.js";import{c as Re,R as ut,W as ht,C as mt,T as ft,D as pt,a as De,P as gt,O as vt,b as yt}from"./index-B5FmTQpp.js";import{c as M}from"./utils-BEHD0UYf.js";import{c as Oe}from"./createLucideIcon-CwMMISn7.js";import{u as xt}from"./useQuery-DJjewD8N.js";import{u as wt}from"./QueryClientProvider-ChAT3DNt.js";import{u as Se}from"./useMutation-CbNZKspy.js";import{u as _t}from"./auth-provider-Diczkjh1.js";import{c as jt}from"./AdminService-CgJGPFg0.js";import{C as St}from"./camera-C1ij0UEm.js";import{R as Ct}from"./refresh-cw-BWYUqUKP.js";import"./index-B2a0W2do.js";import"./index-CpAFY4EY.js";import"./index-BnHrxEV7.js";import"./index-7INpPUcb.js";import"./useBaseQuery-CE2J4sU2.js";import"./mutation-BtzxBK-B.js";var Ae="AlertDialog",[Et]=ct(Ae,[Re]),P=Re(),Pe=s=>{const{__scopeAlertDialog:e,...t}=s,r=P(e);return a.jsx(ut,{...r,...t,modal:!0})};Pe.displayName=Ae;var Nt="AlertDialogTrigger",bt=d.forwardRef((s,e)=>{const{__scopeAlertDialog:t,...r}=s,i=P(t);return a.jsx(yt,{...i,...r,ref:e})});bt.displayName=Nt;var Rt="AlertDialogPortal",$e=s=>{const{__scopeAlertDialog:e,...t}=s,r=P(e);return a.jsx(gt,{...r,...t})};$e.displayName=Rt;var Dt="AlertDialogOverlay",Me=d.forwardRef((s,e)=>{const{__scopeAlertDialog:t,...r}=s,i=P(t);return a.jsx(vt,{...i,...r,ref:e})});Me.displayName=Dt;var H="AlertDialogContent",[Ot,At]=Et(H),Pt=dt("AlertDialogContent"),Ie=d.forwardRef((s,e)=>{const{__scopeAlertDialog:t,children:r,...i}=s,n=P(t),l=d.useRef(null),f=be(e,l),u=d.useRef(null);return a.jsx(ht,{contentName:H,titleName:Te,docsSlug:"alert-dialog",children:a.jsx(Ot,{scope:t,cancelRef:u,children:a.jsxs(mt,{role:"alertdialog",...n,...i,ref:f,onOpenAutoFocus:lt(i.onOpenAutoFocus,g=>{g.preventDefault(),u.current?.focus({preventScroll:!0})}),onPointerDownOutside:g=>g.preventDefault(),onInteractOutside:g=>g.preventDefault(),children:[a.jsx(Pt,{children:r}),a.jsx(Mt,{contentRef:l})]})})})});Ie.displayName=H;var Te="AlertDialogTitle",ke=d.forwardRef((s,e)=>{const{__scopeAlertDialog:t,...r}=s,i=P(t);return a.jsx(ft,{...i,...r,ref:e})});ke.displayName=Te;var Fe="AlertDialogDescription",Le=d.forwardRef((s,e)=>{const{__scopeAlertDialog:t,...r}=s,i=P(t);return a.jsx(pt,{...i,...r,ref:e})});Le.displayName=Fe;var $t="AlertDialogAction",He=d.forwardRef((s,e)=>{const{__scopeAlertDialog:t,...r}=s,i=P(t);return a.jsx(De,{...i,...r,ref:e})});He.displayName=$t;var qe="AlertDialogCancel",Ve=d.forwardRef((s,e)=>{const{__scopeAlertDialog:t,...r}=s,{cancelRef:i}=At(qe,t),n=P(t),l=be(e,i);return a.jsx(De,{...n,...r,ref:l})});Ve.displayName=qe;var Mt=({contentRef:s})=>{const e=`\`${H}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${H}\` by passing a \`${Fe}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${H}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return d.useEffect(()=>{document.getElementById(s.current?.getAttribute("aria-describedby"))||console.warn(e)},[e,s]),null},It=Pe,Tt=$e,kt=Me,Ft=Ie,Lt=He,Ht=Ve,qt=ke,Vt=Le;function Wt({...s}){return a.jsx(It,{"data-slot":"alert-dialog",...s})}function Ut({...s}){return a.jsx(Tt,{"data-slot":"alert-dialog-portal",...s})}function Bt({className:s,...e}){return a.jsx(kt,{"data-slot":"alert-dialog-overlay",className:M("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",s),...e})}function zt({className:s,...e}){return a.jsxs(Ut,{children:[a.jsx(Bt,{}),a.jsx(Ft,{"data-slot":"alert-dialog-content",className:M("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",s),...e})]})}function Qt({className:s,...e}){return a.jsx("div",{"data-slot":"alert-dialog-header",className:M("flex flex-col gap-2 text-center sm:text-left",s),...e})}function Gt({className:s,...e}){return a.jsx("div",{"data-slot":"alert-dialog-footer",className:M("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",s),...e})}function Kt({className:s,...e}){return a.jsx(qt,{"data-slot":"alert-dialog-title",className:M("text-lg font-semibold",s),...e})}function Zt({className:s,...e}){return a.jsx(Vt,{"data-slot":"alert-dialog-description",className:M("text-muted-foreground text-sm",s),...e})}function Yt({className:s,...e}){return a.jsx(Lt,{className:M(Ne(),s),...e})}function Xt({className:s,...e}){return a.jsx(Ht,{className:M(Ne({variant:"outline"}),s),...e})}/**
 * @license lucide-react v0.537.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],ea=Oe("trash-2",Jt);/**
 * @license lucide-react v0.537.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],aa=Oe("user-plus",ta);class h{constructor(e,t,r,i,n){this._legacyCanvasSize=h.DEFAULT_CANVAS_SIZE,this._preferredCamera="environment",this._maxScansPerSecond=25,this._lastScanTimestamp=-1,this._destroyed=this._flashOn=this._paused=this._active=!1,this.$video=e,this.$canvas=document.createElement("canvas"),r&&typeof r=="object"?this._onDecode=t:(console.warn(r||i||n?"You're using a deprecated version of the QrScanner constructor which will be removed in the future":"Note that the type of the scan result passed to onDecode will change in the future. To already switch to the new api today, you can pass returnDetailedScanResult: true."),this._legacyOnDecode=t),t=typeof r=="object"?r:{},this._onDecodeError=t.onDecodeError||(typeof r=="function"?r:this._onDecodeError),this._calculateScanRegion=t.calculateScanRegion||(typeof i=="function"?i:this._calculateScanRegion),this._preferredCamera=t.preferredCamera||n||this._preferredCamera,this._legacyCanvasSize=typeof r=="number"?r:typeof i=="number"?i:this._legacyCanvasSize,this._maxScansPerSecond=t.maxScansPerSecond||this._maxScansPerSecond,this._onPlay=this._onPlay.bind(this),this._onLoadedMetaData=this._onLoadedMetaData.bind(this),this._onVisibilityChange=this._onVisibilityChange.bind(this),this._updateOverlay=this._updateOverlay.bind(this),e.disablePictureInPicture=!0,e.playsInline=!0,e.muted=!0;let l=!1;if(e.hidden&&(e.hidden=!1,l=!0),document.body.contains(e)||(document.body.appendChild(e),l=!0),r=e.parentElement,t.highlightScanRegion||t.highlightCodeOutline){if(i=!!t.overlay,this.$overlay=t.overlay||document.createElement("div"),n=this.$overlay.style,n.position="absolute",n.display="none",n.pointerEvents="none",this.$overlay.classList.add("scan-region-highlight"),!i&&t.highlightScanRegion){this.$overlay.innerHTML='<svg class="scan-region-highlight-svg" viewBox="0 0 238 238" preserveAspectRatio="none" style="position:absolute;width:100%;height:100%;left:0;top:0;fill:none;stroke:#e9b213;stroke-width:4;stroke-linecap:round;stroke-linejoin:round"><path d="M31 2H10a8 8 0 0 0-8 8v21M207 2h21a8 8 0 0 1 8 8v21m0 176v21a8 8 0 0 1-8 8h-21m-176 0H10a8 8 0 0 1-8-8v-21"/></svg>';try{this.$overlay.firstElementChild.animate({transform:["scale(.98)","scale(1.01)"]},{duration:400,iterations:1/0,direction:"alternate",easing:"ease-in-out"})}catch{}r.insertBefore(this.$overlay,this.$video.nextSibling)}t.highlightCodeOutline&&(this.$overlay.insertAdjacentHTML("beforeend",'<svg class="code-outline-highlight" preserveAspectRatio="none" style="display:none;width:100%;height:100%;fill:none;stroke:#e9b213;stroke-width:5;stroke-dasharray:25;stroke-linecap:round;stroke-linejoin:round"><polygon/></svg>'),this.$codeOutlineHighlight=this.$overlay.lastElementChild)}this._scanRegion=this._calculateScanRegion(e),requestAnimationFrame(()=>{let f=window.getComputedStyle(e);f.display==="none"&&(e.style.setProperty("display","block","important"),l=!0),f.visibility!=="visible"&&(e.style.setProperty("visibility","visible","important"),l=!0),l&&(console.warn("QrScanner has overwritten the video hiding style to avoid Safari stopping the playback."),e.style.opacity="0",e.style.width="0",e.style.height="0",this.$overlay&&this.$overlay.parentElement&&this.$overlay.parentElement.removeChild(this.$overlay),delete this.$overlay,delete this.$codeOutlineHighlight),this.$overlay&&this._updateOverlay()}),e.addEventListener("play",this._onPlay),e.addEventListener("loadedmetadata",this._onLoadedMetaData),document.addEventListener("visibilitychange",this._onVisibilityChange),window.addEventListener("resize",this._updateOverlay),this._qrEnginePromise=h.createQrEngine()}static set WORKER_PATH(e){console.warn("Setting QrScanner.WORKER_PATH is not required and not supported anymore. Have a look at the README for new setup instructions.")}static async hasCamera(){try{return!!(await h.listCameras(!1)).length}catch{return!1}}static async listCameras(e=!1){if(!navigator.mediaDevices)return[];let t=async()=>(await navigator.mediaDevices.enumerateDevices()).filter(i=>i.kind==="videoinput"),r;try{e&&(await t()).every(i=>!i.label)&&(r=await navigator.mediaDevices.getUserMedia({audio:!1,video:!0}))}catch{}try{return(await t()).map((i,n)=>({id:i.deviceId,label:i.label||(n===0?"Default Camera":`Camera ${n+1}`)}))}finally{r&&(console.warn("Call listCameras after successfully starting a QR scanner to avoid creating a temporary video stream"),h._stopVideoStream(r))}}async hasFlash(){let e;try{if(this.$video.srcObject){if(!(this.$video.srcObject instanceof MediaStream))return!1;e=this.$video.srcObject}else e=(await this._getCameraStream()).stream;return"torch"in e.getVideoTracks()[0].getSettings()}catch{return!1}finally{e&&e!==this.$video.srcObject&&(console.warn("Call hasFlash after successfully starting the scanner to avoid creating a temporary video stream"),h._stopVideoStream(e))}}isFlashOn(){return this._flashOn}async toggleFlash(){this._flashOn?await this.turnFlashOff():await this.turnFlashOn()}async turnFlashOn(){if(!this._flashOn&&!this._destroyed&&(this._flashOn=!0,this._active&&!this._paused))try{if(!await this.hasFlash())throw"No flash available";await this.$video.srcObject.getVideoTracks()[0].applyConstraints({advanced:[{torch:!0}]})}catch(e){throw this._flashOn=!1,e}}async turnFlashOff(){this._flashOn&&(this._flashOn=!1,await this._restartVideoStream())}destroy(){this.$video.removeEventListener("loadedmetadata",this._onLoadedMetaData),this.$video.removeEventListener("play",this._onPlay),document.removeEventListener("visibilitychange",this._onVisibilityChange),window.removeEventListener("resize",this._updateOverlay),this._destroyed=!0,this._flashOn=!1,this.stop(),h._postWorkerMessage(this._qrEnginePromise,"close")}async start(){if(this._destroyed)throw Error("The QR scanner can not be started as it had been destroyed.");if((!this._active||this._paused)&&(window.location.protocol!=="https:"&&console.warn("The camera stream is only accessible if the page is transferred via https."),this._active=!0,!document.hidden))if(this._paused=!1,this.$video.srcObject)await this.$video.play();else try{let{stream:e,facingMode:t}=await this._getCameraStream();!this._active||this._paused?h._stopVideoStream(e):(this._setVideoMirror(t),this.$video.srcObject=e,await this.$video.play(),this._flashOn&&(this._flashOn=!1,this.turnFlashOn().catch(()=>{})))}catch(e){if(!this._paused)throw this._active=!1,e}}stop(){this.pause(),this._active=!1}async pause(e=!1){if(this._paused=!0,!this._active)return!0;this.$video.pause(),this.$overlay&&(this.$overlay.style.display="none");let t=()=>{this.$video.srcObject instanceof MediaStream&&(h._stopVideoStream(this.$video.srcObject),this.$video.srcObject=null)};return e?(t(),!0):(await new Promise(r=>setTimeout(r,300)),this._paused?(t(),!0):!1)}async setCamera(e){e!==this._preferredCamera&&(this._preferredCamera=e,await this._restartVideoStream())}static async scanImage(e,t,r,i,n=!1,l=!1){let f,u=!1;t&&("scanRegion"in t||"qrEngine"in t||"canvas"in t||"disallowCanvasResizing"in t||"alsoTryWithoutScanRegion"in t||"returnDetailedScanResult"in t)?(f=t.scanRegion,r=t.qrEngine,i=t.canvas,n=t.disallowCanvasResizing||!1,l=t.alsoTryWithoutScanRegion||!1,u=!0):console.warn(t||r||i||n||l?"You're using a deprecated api for scanImage which will be removed in the future.":"Note that the return type of scanImage will change in the future. To already switch to the new api today, you can pass returnDetailedScanResult: true."),t=!!r;try{let g,p;[r,g]=await Promise.all([r||h.createQrEngine(),h._loadImage(e)]),[i,p]=h._drawToCanvas(g,f,i,n);let x;if(r instanceof Worker){let o=r;t||h._postWorkerMessageSync(o,"inversionMode","both"),x=await new Promise((m,E)=>{let y,R,D,T=-1;R=N=>{N.data.id===T&&(o.removeEventListener("message",R),o.removeEventListener("error",D),clearTimeout(y),N.data.data!==null?m({data:N.data.data,cornerPoints:h._convertPoints(N.data.cornerPoints,f)}):E(h.NO_QR_CODE_FOUND))},D=N=>{o.removeEventListener("message",R),o.removeEventListener("error",D),clearTimeout(y),E("Scanner error: "+(N?N.message||N:"Unknown Error"))},o.addEventListener("message",R),o.addEventListener("error",D),y=setTimeout(()=>D("timeout"),1e4);let $=p.getImageData(0,0,i.width,i.height);T=h._postWorkerMessageSync(o,"decode",$,[$.data.buffer])})}else x=await Promise.race([new Promise((o,m)=>window.setTimeout(()=>m("Scanner error: timeout"),1e4)),(async()=>{try{var[o]=await r.detect(i);if(!o)throw h.NO_QR_CODE_FOUND;return{data:o.rawValue,cornerPoints:h._convertPoints(o.cornerPoints,f)}}catch(m){if(o=m.message||m,/not implemented|service unavailable/.test(o))return h._disableBarcodeDetector=!0,h.scanImage(e,{scanRegion:f,canvas:i,disallowCanvasResizing:n,alsoTryWithoutScanRegion:l});throw`Scanner error: ${o}`}})()]);return u?x:x.data}catch(g){if(!f||!l)throw g;let p=await h.scanImage(e,{qrEngine:r,canvas:i,disallowCanvasResizing:n});return u?p:p.data}finally{t||h._postWorkerMessage(r,"close")}}setGrayscaleWeights(e,t,r,i=!0){h._postWorkerMessage(this._qrEnginePromise,"grayscaleWeights",{red:e,green:t,blue:r,useIntegerApproximation:i})}setInversionMode(e){h._postWorkerMessage(this._qrEnginePromise,"inversionMode",e)}static async createQrEngine(e){if(e&&console.warn("Specifying a worker path is not required and not supported anymore."),e=()=>et(()=>import("./qr-scanner-worker.min-D85Z9gVD.js"),[]).then(r=>r.createWorker()),!(!h._disableBarcodeDetector&&"BarcodeDetector"in window&&BarcodeDetector.getSupportedFormats&&(await BarcodeDetector.getSupportedFormats()).includes("qr_code")))return e();let t=navigator.userAgentData;return t&&t.brands.some(({brand:r})=>/Chromium/i.test(r))&&/mac ?OS/i.test(t.platform)&&await t.getHighEntropyValues(["architecture","platformVersion"]).then(({architecture:r,platformVersion:i})=>/arm/i.test(r||"arm")&&13<=parseInt(i||"13")).catch(()=>!0)?e():new BarcodeDetector({formats:["qr_code"]})}_onPlay(){this._scanRegion=this._calculateScanRegion(this.$video),this._updateOverlay(),this.$overlay&&(this.$overlay.style.display=""),this._scanFrame()}_onLoadedMetaData(){this._scanRegion=this._calculateScanRegion(this.$video),this._updateOverlay()}_onVisibilityChange(){document.hidden?this.pause():this._active&&this.start()}_calculateScanRegion(e){let t=Math.round(.6666666666666666*Math.min(e.videoWidth,e.videoHeight));return{x:Math.round((e.videoWidth-t)/2),y:Math.round((e.videoHeight-t)/2),width:t,height:t,downScaledWidth:this._legacyCanvasSize,downScaledHeight:this._legacyCanvasSize}}_updateOverlay(){requestAnimationFrame(()=>{if(this.$overlay){var e=this.$video,t=e.videoWidth,r=e.videoHeight,i=e.offsetWidth,n=e.offsetHeight,l=e.offsetLeft,f=e.offsetTop,u=window.getComputedStyle(e),g=u.objectFit,p=t/r,x=i/n;switch(g){case"none":var o=t,m=r;break;case"fill":o=i,m=n;break;default:(g==="cover"?p>x:p<x)?(m=n,o=m*p):(o=i,m=o/p),g==="scale-down"&&(o=Math.min(o,t),m=Math.min(m,r))}var[E,y]=u.objectPosition.split(" ").map((D,T)=>{const $=parseFloat(D);return D.endsWith("%")?(T?n-m:i-o)*$/100:$});u=this._scanRegion.width||t,x=this._scanRegion.height||r,g=this._scanRegion.x||0;var R=this._scanRegion.y||0;p=this.$overlay.style,p.width=`${u/t*o}px`,p.height=`${x/r*m}px`,p.top=`${f+y+R/r*m}px`,r=/scaleX\(-1\)/.test(e.style.transform),p.left=`${l+(r?i-E-o:E)+(r?t-g-u:g)/t*o}px`,p.transform=e.style.transform}})}static _convertPoints(e,t){if(!t)return e;let r=t.x||0,i=t.y||0,n=t.width&&t.downScaledWidth?t.width/t.downScaledWidth:1;t=t.height&&t.downScaledHeight?t.height/t.downScaledHeight:1;for(let l of e)l.x=l.x*n+r,l.y=l.y*t+i;return e}_scanFrame(){!this._active||this.$video.paused||this.$video.ended||("requestVideoFrameCallback"in this.$video?this.$video.requestVideoFrameCallback.bind(this.$video):requestAnimationFrame)(async()=>{if(!(1>=this.$video.readyState)){var e=Date.now()-this._lastScanTimestamp,t=1e3/this._maxScansPerSecond;e<t&&await new Promise(i=>setTimeout(i,t-e)),this._lastScanTimestamp=Date.now();try{var r=await h.scanImage(this.$video,{scanRegion:this._scanRegion,qrEngine:this._qrEnginePromise,canvas:this.$canvas})}catch(i){if(!this._active)return;this._onDecodeError(i)}!h._disableBarcodeDetector||await this._qrEnginePromise instanceof Worker||(this._qrEnginePromise=h.createQrEngine()),r?(this._onDecode?this._onDecode(r):this._legacyOnDecode&&this._legacyOnDecode(r.data),this.$codeOutlineHighlight&&(clearTimeout(this._codeOutlineHighlightRemovalTimeout),this._codeOutlineHighlightRemovalTimeout=void 0,this.$codeOutlineHighlight.setAttribute("viewBox",`${this._scanRegion.x||0} ${this._scanRegion.y||0} ${this._scanRegion.width||this.$video.videoWidth} ${this._scanRegion.height||this.$video.videoHeight}`),this.$codeOutlineHighlight.firstElementChild.setAttribute("points",r.cornerPoints.map(({x:i,y:n})=>`${i},${n}`).join(" ")),this.$codeOutlineHighlight.style.display="")):this.$codeOutlineHighlight&&!this._codeOutlineHighlightRemovalTimeout&&(this._codeOutlineHighlightRemovalTimeout=setTimeout(()=>this.$codeOutlineHighlight.style.display="none",100))}this._scanFrame()})}_onDecodeError(e){e!==h.NO_QR_CODE_FOUND&&console.log(e)}async _getCameraStream(){if(!navigator.mediaDevices)throw"Camera not found.";let e=/^(environment|user)$/.test(this._preferredCamera)?"facingMode":"deviceId",t=[{width:{min:1024}},{width:{min:768}},{}],r=t.map(i=>Object.assign({},i,{[e]:{exact:this._preferredCamera}}));for(let i of[...r,...t])try{let n=await navigator.mediaDevices.getUserMedia({video:i,audio:!1}),l=this._getFacingMode(n)||(i.facingMode?this._preferredCamera:this._preferredCamera==="environment"?"user":"environment");return{stream:n,facingMode:l}}catch{}throw"Camera not found."}async _restartVideoStream(){let e=this._paused;await this.pause(!0)&&!e&&this._active&&await this.start()}static _stopVideoStream(e){for(let t of e.getTracks())t.stop(),e.removeTrack(t)}_setVideoMirror(e){this.$video.style.transform="scaleX("+(e==="user"?-1:1)+")"}_getFacingMode(e){return(e=e.getVideoTracks()[0])?/rear|back|environment/i.test(e.label)?"environment":/front|user|face/i.test(e.label)?"user":null:null}static _drawToCanvas(e,t,r,i=!1){r=r||document.createElement("canvas");let n=t&&t.x?t.x:0,l=t&&t.y?t.y:0,f=t&&t.width?t.width:e.videoWidth||e.width,u=t&&t.height?t.height:e.videoHeight||e.height;return i||(i=t&&t.downScaledWidth?t.downScaledWidth:f,t=t&&t.downScaledHeight?t.downScaledHeight:u,r.width!==i&&(r.width=i),r.height!==t&&(r.height=t)),t=r.getContext("2d",{alpha:!1}),t.imageSmoothingEnabled=!1,t.drawImage(e,n,l,f,u,0,0,r.width,r.height),[r,t]}static async _loadImage(e){if(e instanceof Image)return await h._awaitImageLoad(e),e;if(e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement||e instanceof SVGImageElement||"OffscreenCanvas"in window&&e instanceof OffscreenCanvas||"ImageBitmap"in window&&e instanceof ImageBitmap)return e;if(e instanceof File||e instanceof Blob||e instanceof URL||typeof e=="string"){let t=new Image;t.src=e instanceof File||e instanceof Blob?URL.createObjectURL(e):e.toString();try{return await h._awaitImageLoad(t),t}finally{(e instanceof File||e instanceof Blob)&&URL.revokeObjectURL(t.src)}}else throw"Unsupported image type."}static async _awaitImageLoad(e){e.complete&&e.naturalWidth!==0||await new Promise((t,r)=>{let i=n=>{e.removeEventListener("load",i),e.removeEventListener("error",i),n instanceof ErrorEvent?r("Image load error"):t()};e.addEventListener("load",i),e.addEventListener("error",i)})}static async _postWorkerMessage(e,t,r,i){return h._postWorkerMessageSync(await e,t,r,i)}static _postWorkerMessageSync(e,t,r,i){if(!(e instanceof Worker))return-1;let n=h._workerMessageId++;return e.postMessage({id:n,type:t,data:r},i),n}}h.DEFAULT_CANVAS_SIZE=400;h.NO_QR_CODE_FOUND="No QR code found";h._disableBarcodeDetector=!1;h._workerMessageId=0;const W={cafe:"Café",almoco:"Almoço",janta:"Jantar",ceia:"Ceia"},sa=()=>{const s=new Date,e=[];for(const t of[-1,0,1]){const r=new Date(s);r.setDate(s.getDate()+t),e.push(r.toISOString().split("T")[0])}return e};function ra({selectedDate:s,setSelectedDate:e,selectedMeal:t,setSelectedMeal:r,selectedUnit:i,setSelectedUnit:n,dates:l}){const f="w-full h-10 rounded-md border border-input bg-background px-3 py-2 text-sm text-foreground ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50";return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"flex-1",children:(()=>{const u=!s||l.includes(s),g=!1,p=!!(s&&!u);return a.jsxs("div",{className:"space-y-2",children:[a.jsxs(ae,{className:"text-sm font-medium flex items-center justify-between text-foreground",children:[a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(ot,{className:"h-4 w-4"}),a.jsx("span",{children:"Dia:"})]}),a.jsx("div",{className:"flex items-center space-x-2",children:p&&a.jsxs(a.Fragment,{children:[a.jsx(V,{variant:"destructive",className:"text-xs",children:"Inválido"}),a.jsx(G,{className:"h-4 w-4 text-destructive"})]})})]}),a.jsxs(ve,{value:s,onValueChange:o=>e(o),disabled:g,children:[a.jsx(ye,{className:`${f} ${p?"border-destructive/50 bg-destructive/10":""}`,"aria-invalid":p,children:a.jsx(xe,{placeholder:"Selecione o dia",children:s&&a.jsx("div",{className:"flex items-center space-x-2",children:a.jsx("span",{children:K(s)})})})}),a.jsxs(we,{className:"max-h-60",children:[a.jsx("div",{className:"p-2 text-xs text-muted-foreground border-b border-border",children:"Selecione o dia do cardápio"}),l.map(o=>{const m=o===s;return a.jsx(_e,{className:"cursor-pointer hover:bg-accent/50 focus:bg-accent/50 transition-colors",value:o,children:a.jsxs("div",{className:"flex items-center justify-between w-full",children:[a.jsx("span",{children:K(o)}),m&&a.jsx(je,{className:"h-4 w-4 text-primary ml-2"})]})},o)})]})]}),p&&a.jsxs("div",{className:"text-xs text-destructive flex items-center space-x-1",children:[a.jsx(G,{className:"h-3 w-3"}),a.jsx("span",{children:"Data inválida selecionada"})]})]})})()}),a.jsx("div",{className:"flex-1",children:(()=>{const u=Object.keys(W),g=!t||u.includes(t),p=!1,x=!!(t&&!g);return a.jsxs("div",{className:"space-y-2",children:[a.jsxs(ae,{className:"text-sm font-medium flex items-center justify-between text-foreground",children:[a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(nt,{className:"h-4 w-4"}),a.jsx("span",{children:"Refeição:"})]}),a.jsx("div",{className:"flex items-center space-x-2",children:x&&a.jsxs(a.Fragment,{children:[a.jsx(V,{variant:"destructive",className:"text-xs",children:"Inválida"}),a.jsx(G,{className:"h-4 w-4 text-destructive"})]})})]}),a.jsxs(ve,{value:t,onValueChange:m=>r(m),disabled:p,children:[a.jsx(ye,{className:`${f} ${x?"border-destructive/50 bg-destructive/10":""}`,"aria-invalid":x,children:a.jsx(xe,{placeholder:"Selecione a refeição",children:t&&a.jsx("div",{className:"flex items-center space-x-2",children:a.jsx("span",{children:W[t]})})})}),a.jsxs(we,{className:"max-h-60",children:[a.jsx("div",{className:"p-2 text-xs text-muted-foreground border-b border-border",children:"Selecione o tipo de refeição"}),u.map(m=>{const E=m===t;return a.jsx(_e,{className:"cursor-pointer hover:bg-accent/50 focus:bg-accent/50 transition-colors",value:m,children:a.jsxs("div",{className:"flex items-center justify-between w-full",children:[a.jsx("span",{children:W[m]}),E&&a.jsx(je,{className:"h-4 w-4 text-primary ml-2"})]})},m)})]})]}),x&&a.jsxs("div",{className:"text-xs text-destructive flex items-center space-x-1",children:[a.jsx(G,{className:"h-3 w-3"}),a.jsx("span",{children:"Refeição inválida selecionada"})]})]})})()}),a.jsx("div",{className:"flex-1",children:a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("div",{className:"w-full sm:w-64",children:a.jsx(it,{value:i,onChange:n,placeholder:"Selecione a OM..."})})})})]})}const te=new Map;function ia({setDialog:s,dialog:e,confirmDialog:t,selectedUnit:r,resolveDisplayName:i}){const n=!!e.systemForecast,l=!e.systemForecast,[f,u]=d.useState(null),[g,p]=d.useState(!1);d.useEffect(()=>{let o=!1;const m=e.uuid?.trim();if(!m||!i){u(null);return}if(te.has(m)){u(te.get(m)??null);return}return p(!0),i(m).then(E=>{if(o)return;const y=E?.trim()||null;y&&te.set(m,y),u(y)}).catch(()=>{}).finally(()=>{o||p(!1)}),()=>{o=!0}},[e.uuid,i]);const x=g?"Carregando...":f||e.uuid||"—";return a.jsx(a.Fragment,{children:a.jsx(Wt,{open:e.open,onOpenChange:o=>s(m=>({...m,open:o})),children:a.jsxs(zt,{children:[a.jsxs(Qt,{children:[a.jsx(Kt,{children:"Confirmar entrada do militar"}),a.jsxs(Zt,{children:["Pessoa: ",x,a.jsx("br",{}),"Previsão do sistema:"," ",e.systemForecast===null?"Não encontrado":e.systemForecast?"Previsto":"Não previsto"]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"text-sm font-medium",children:"Está na previsão?"}),a.jsxs("div",{className:"flex gap-2",role:"group","aria-label":"Está na previsão",children:[a.jsx(A,{disabled:!0,variant:n?"default":"outline",size:"sm","aria-pressed":n,children:"Sim"}),a.jsx(A,{disabled:!0,variant:l?"default":"outline",size:"sm","aria-pressed":l,children:"Não"})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"text-sm font-medium",children:"Vai entrar?"}),a.jsxs("div",{className:"flex gap-2",role:"group","aria-label":"Vai entrar",children:[a.jsx(A,{variant:e.willEnter==="sim"?"default":"outline",size:"sm","aria-pressed":e.willEnter==="sim",onClick:()=>s(o=>({...o,willEnter:"sim"})),children:"Sim"}),a.jsx(A,{variant:e.willEnter==="nao"?"destructive":"outline",size:"sm","aria-pressed":e.willEnter==="nao",onClick:()=>s(o=>({...o,willEnter:"nao"})),children:"Não"})]})]}),r&&a.jsxs("div",{className:"text-xs text-muted-foreground",children:["Rancho selecionado: ",r]})]}),a.jsxs(Gt,{children:[a.jsx(Xt,{onClick:()=>s(o=>({...o,open:!1})),children:"Cancelar"}),a.jsx(Yt,{onClick:t,children:"Confirmar"})]})]})})})}function na({selectedDate:s,selectedMeal:e,presences:t,forecastMap:r,actions:i}){return a.jsx(a.Fragment,{children:a.jsxs("div",{className:"rounded-xl border bg-card text-card-foreground shadow-sm",children:[a.jsxs("div",{className:"px-4 py-3 border-b border-border flex items-center justify-between bg-muted/50",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",children:"Presenças registradas"}),a.jsxs("p",{className:"text-sm text-muted-foreground",children:["Dia ",K(s)," · ",W[e]]})]}),a.jsx(V,{variant:"secondary",children:t.length})]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs(tt,{children:[a.jsx(at,{className:"bg-muted/50",children:a.jsxs(ee,{children:[a.jsx(F,{className:"text-muted-foreground",children:"Pessoa"}),a.jsx(F,{className:"text-muted-foreground",children:"Data"}),a.jsx(F,{className:"text-muted-foreground",children:"Refeição"}),a.jsx(F,{className:"text-muted-foreground",children:"Previsão"}),a.jsx(F,{className:"text-muted-foreground",children:"Registrado em"}),a.jsx(F,{className:"text-right text-muted-foreground",children:"Ações"})]})}),a.jsx(st,{children:t.length===0?a.jsx(ee,{children:a.jsx(I,{colSpan:6,className:"h-24 text-center text-muted-foreground",children:"Nenhuma presença registrada ainda."})}):t.map(n=>{const l=n,f=r[n.user_id]??!1,u=l.display_name?.trim()||n.user_id;return a.jsxs(ee,{className:"hover:bg-accent/50",children:[a.jsx(I,{children:a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"font-medium",children:u}),a.jsx("span",{className:"font-mono text-xs text-muted-foreground",children:n.user_id})]})}),a.jsx(I,{children:K(n.date)}),a.jsx(I,{children:W[n.meal]}),a.jsx(I,{children:f?a.jsx(V,{variant:"default",children:"Sim"}):a.jsx(V,{variant:"outline",children:"Não"})}),a.jsx(I,{children:new Date(n.created_at).toLocaleString("pt-BR")}),a.jsx(I,{className:"text-right",children:a.jsx(A,{variant:"ghost",size:"icon",className:"text-destructive hover:bg-destructive/10",onClick:()=>i.removePresence(n),"aria-label":"Remover presença",children:a.jsx(ea,{className:"h-4 w-4"})})})]},n.id)})})]})})]})})}class se extends Error{constructor(){super("unit_required"),this.name="UnitRequiredError"}}const oa=s=>typeof s=="object"&&s!==null&&"code"in s&&typeof s.code=="string",L={all:["presences"],list:(s,e,t)=>[...L.all,s,e,t],confirm:(s,e,t)=>["confirmPresence",s,e,t],remove:(s,e,t)=>["removePresence",s,e,t]},Ce=new Map;async function re(s){if(!s)return;const e=Ce.get(s);if(e)return e;const{data:t,error:r}=await O.schema("sisub").from("mess_halls").select("id").eq("code",s).maybeSingle();if(r){console.warn("Falha ao buscar mess_hall_id:",r);return}const i=t?.id;return i&&Ce.set(s,i),i}const ca=async s=>{if(!s.unit)return[];const e=await re(s.unit);if(!e)return console.warn(`Código de rancho não encontrado: ${s.unit}`),[];const{data:t,error:r}=await O.from("v_meal_presences_with_user").select("id, user_id, date, meal, created_at, mess_hall_id, display_name").eq("date",s.date).eq("meal",s.meal).eq("mess_hall_id",e).order("created_at",{ascending:!1}).returns();if(r)throw console.error("Erro ao buscar presenças:",r),j.error("Erro",{description:"Não foi possível carregar as presenças."}),r;return(t??[]).map(l=>{const f={id:l.id,user_id:l.user_id,date:l.date,meal:l.meal,created_at:l.created_at,unidade:s.unit};return Object.assign(f,{display_name:l.display_name??null})})},la=async(s,e)=>{if(e.length===0)return{};if(!s.unit)return{};const t=await re(s.unit);if(!t)return console.warn(`Código de rancho não encontrado: ${s.unit}`),{};const{data:r,error:i}=await O.schema("sisub").from("meal_forecasts").select("user_id, will_eat").eq("date",s.date).eq("meal",s.meal).eq("mess_hall_id",t).in("user_id",e).returns();if(i)return console.warn("Falha ao buscar previsões:",i),{};const n={};return(r??[]).forEach(l=>{n[l.user_id]=!!l.will_eat}),n},da=async(s,e)=>{if(!e.unit)throw new se;const t=await re(e.unit);if(!t)throw new se;const{error:r}=await O.schema("sisub").from("meal_presences").insert({user_id:s.uuid,date:e.date,meal:e.meal,mess_hall_id:t});if(r)throw r},ua=async s=>{const{error:e}=await O.schema("sisub").from("meal_presences").delete().eq("id",s);if(e)throw e},ha=s=>!!(s.date&&s.meal&&s.unit),ma=s=>{if(s instanceof se){j.error("Selecione o rancho",{description:"É necessário informar a unidade (rancho)."});return}if(oa(s)&&s.code==="23505"){j.info("Já registrado",{description:"Este militar já foi marcado presente."});return}console.error("Falha ao salvar decisão:",s),j.error("Erro",{description:"Falha ao salvar decisão."})},fa=s=>{console.error("Não foi possível excluir:",s),j.error("Erro",{description:"Não foi possível excluir."})};function pa(s){const e=wt(),t=ha(s),r=xt({queryKey:L.list(s.date,s.meal,s.unit),queryFn:async()=>{const u=await ca(s),g=Array.from(new Set(u.map(x=>x.user_id))),p=await la(s,g);return{presences:u,forecastMap:p}},enabled:t,refetchOnWindowFocus:!1,refetchOnMount:!1,retry:1,staleTime:120*1e3,gcTime:300*1e3,placeholderData:{presences:[],forecastMap:{}}}),i=Se({mutationKey:L.confirm(s.date,s.meal,s.unit),mutationFn:async u=>u.willEnter?(await da(u,s),j.success("Presença registrada",{description:`UUID ${u.uuid} marcado.`}),{skipped:!1}):(j.info("Registro atualizado",{description:"Decisão registrada. Militar não entrará para a refeição."}),{skipped:!0}),onSuccess:()=>{e.invalidateQueries({queryKey:L.list(s.date,s.meal,s.unit)})},onError:ma}),n=Se({mutationKey:L.remove(s.date,s.meal,s.unit),mutationFn:async u=>{await ua(u.id),j.success("Excluído",{description:"Registro removido."})},onSuccess:()=>{e.invalidateQueries({queryKey:L.list(s.date,s.meal,s.unit)})},onError:fa}),l=d.useCallback(async(u,g)=>await i.mutateAsync({uuid:u,willEnter:g}),[i]),f=d.useCallback(async u=>{await n.mutateAsync(u)},[n]);return{presences:r.data?.presences??[],forecastMap:r.data?.forecastMap??{},isLoading:r.isLoading||r.isFetching,isConfirming:i.isPending,isRemoving:n.isPending,confirmPresence:l,removePresence:f}}const Ee=new Map;async function ga(s){if(!s)return null;const e=Ee.get(s);if(e)return e;const{data:t,error:r}=await O.schema("sisub").from("v_user_identity").select("display_name").eq("id",s).maybeSingle();if(r)return console.warn("Falha ao buscar display_name:",r),null;const i=t?.display_name?.trim()||null;return i&&Ee.set(s,i),i}const va=/\b[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}\b/i;function ya(s){if(!s)return null;const e=s.match(va);return e?e[0].toLowerCase():null}function Xa(){return[{title:"Fiscalização - Leitor de QR"},{name:"description",content:"Fiscalize a refeição escaneando o QR do militar"}]}function xa(s=new Date){const e=(i,n=0)=>i*60+n,t=s.getHours()*60+s.getMinutes(),r=(i,n)=>t>=i&&t<n;return r(e(4),e(9))?"cafe":r(e(9),e(15))?"almoco":r(e(15),e(20))?"janta":"ceia"}const wa=(s,e)=>{switch(e.type){case"INITIALIZE_SUCCESS":return{...s,isReady:!0,isScanning:e.hasPermission,hasPermission:e.hasPermission,error:void 0};case"INITIALIZE_ERROR":return{...s,isReady:!0,isScanning:!1,hasPermission:!1,error:e.error};case"TOGGLE_SCAN":return{...s,isScanning:e.isScanning};case"REFRESH":return{...s,isScanning:s.hasPermission,error:void 0};default:return s}},Ja=Xe(function(){const e=d.useRef(null),t=d.useRef(null),r=d.useRef(null),[i,n]=d.useState(!0),[l,f]=d.useState(!1),u=d.useMemo(()=>sa(),[]),g=d.useMemo(()=>xa(),[]),[p,x]=d.useState(!1),{user:o}=_t(),[m,E]=d.useState(!1);if(d.useEffect(()=>{(async()=>{o?.id&&await jt(o.id)===null&&E(!0)})()},[o]),m)return a.jsx(Je,{to:"/rancho",replace:!0});const[y,R]=d.useState({date:u[1],meal:g,unit:"DIRAD - DIRAD"}),D=800,T=300,$=d.useRef(0),N=d.useRef(new Set),We=d.useRef([]),Ue=c=>{const v=N.current,w=We.current;if(!v.has(c)&&(v.add(c),w.push(c),w.length>T)){const _=w.shift();_&&v.delete(_)}},Be={isReady:!1,isScanning:!1,hasPermission:!1},[b,k]=d.useReducer(wa,Be),[Z,ie]=d.useState(""),U=d.useRef(y);d.useEffect(()=>{U.current=y},[y]);const[S,Y]=d.useState({open:!1,uuid:null,systemForecast:null,willEnter:"sim"}),ne=d.useRef(new Map),q=d.useCallback(async c=>{if(!c)return;const v=ne.current.get(c);if(v)return v;const{data:w,error:_}=await O.schema("sisub").from("mess_halls").select("id").eq("code",c).maybeSingle();if(_){console.warn("Falha ao buscar mess_hall_id:",_);return}const C=w?.id;return C&&ne.current.set(c,C),C},[]),[oe,ce]=d.useState(0),B=d.useCallback(async()=>{const{date:c,meal:v,unit:w}=U.current;if(!c||!v||!w)return;const _=await q(w);if(!_){ce(0);return}const{error:C,count:J}=await O.schema("sisub").from("other_presences").select("*",{count:"exact",head:!0}).eq("date",c).eq("meal",v).eq("mess_hall_id",_);C||ce(J??0)},[q]),ze=d.useCallback(async()=>{if(!o?.id){j.error("Erro",{description:"Usuário não autenticado."});return}const{date:c,meal:v,unit:w}=U.current;if(!c||!v||!w){j.error("Filtros incompletos",{description:"Selecione data, refeição e unidade."});return}x(!0);try{const _=await q(w);if(!_){j.error("Unidade inválida",{description:"Não foi possível mapear o código de rancho para o ID. Verifique a unidade selecionada."});return}const{error:C}=await O.schema("sisub").from("other_presences").insert({admin_id:o.id,date:c,meal:v,mess_hall_id:_});if(C)throw C;j.success("Outro registrado",{description:"Entrada sem cadastro adicionada com sucesso."})}catch(_){console.error("Erro ao registrar Outros:",_),j.error("Erro",{description:"Não foi possível registrar a entrada."})}finally{await B(),x(!1)}},[o?.id,q,B]);d.useEffect(()=>{B()},[y.date,y.meal,y.unit,B]);const{presences:Qe,forecastMap:Ge,confirmPresence:le,removePresence:de}=pa(y);d.useEffect(()=>{let c=!1;return(async()=>{if(t.current)try{if(!await h.hasCamera()){c||k({type:"INITIALIZE_ERROR",error:"Permissão da câmera não concedida."});return}const _=new h(t.current,C=>Ke(C),{onDecodeError:Ze,preferredCamera:"environment",highlightScanRegion:!0,highlightCodeOutline:!0,overlay:r.current??void 0});e.current=_,await _.start(),c||k({type:"INITIALIZE_SUCCESS",hasPermission:!0})}catch(w){console.error("Erro ao iniciar o scanner:",w),c||k({type:"INITIALIZE_ERROR",error:String(w?.message??"Erro desconhecido ao iniciar a câmera.")})}})(),()=>{c=!0,e.current?.stop(),e.current?.destroy(),e.current=null}},[]);const Ke=async c=>{const v=(c?.data||"").trim();if(!v)return;const w=ya(v);if(!w)return;const _=Date.now();if(_-$.current<D||N.current.has(w)||l)return;$.current=_,f(!0);try{await e.current?.stop()}catch{}const{date:C,meal:J,unit:fe}=U.current;try{let Q=null;const pe=await q(fe);if(pe){const{data:ge,error:Ye}=await O.schema("sisub").from("meal_forecasts").select("will_eat").eq("user_id",w).eq("date",C).eq("meal",J).eq("mess_hall_id",pe).maybeSingle();!Ye&&ge&&(Q=!!ge.will_eat)}else console.warn(`Código de rancho não encontrado: ${fe}`);ie(w),Y({open:!0,uuid:w,systemForecast:Q,willEnter:"sim"}),Ue(w)}catch(Q){console.error("Erro ao preparar diálogo:",Q),j.error("Erro",{description:"Falha ao processar QR."})}finally{f(!1)}},Ze=c=>{String(c)!=="No QR code found"&&console.warn("QR Scan Error:",c)},X=d.useCallback(async()=>{if(S.uuid)try{await le(S.uuid,S.willEnter==="sim")}catch(c){console.error("Falha ao confirmar presença:",c)}finally{Y(c=>({...c,open:!1,uuid:null}))}},[S.uuid,S.willEnter,le]),ue=d.useCallback(async()=>{const c=e.current;if(c)try{b.isScanning?(await c.stop(),k({type:"TOGGLE_SCAN",isScanning:!1})):(await c.start(),k({type:"TOGGLE_SCAN",isScanning:!0}))}catch(v){console.error("Erro ao alternar scanner:",v)}},[b.isScanning]),he=d.useCallback(async()=>{const c=e.current;if(c){try{await c.stop()}catch{}try{await c.start(),k({type:"REFRESH"})}catch(v){console.error("Erro no refresh do scanner:",v)}}},[]);d.useEffect(()=>{if(!S.open||!i||!S.uuid)return;const c=setTimeout(()=>{X()},3e3);return()=>clearTimeout(c)},[S.open,S.uuid,i,X]),d.useEffect(()=>{const c=e.current;c&&(S.open?c.stop():b.hasPermission&&c.start().catch(v=>{console.error("Erro ao iniciar scanner:",v)}))},[S.open,b.hasPermission]);const me=d.useCallback(()=>ie(""),[]),z=d.useMemo(()=>({toggleScan:ue,refresh:he,clearResult:me,removePresence:de}),[ue,he,me,de]);return a.jsxs("div",{className:"pt-10 space-y-6 min-h-screen container mx-auto max-w-screen-2xl px-4",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-end gap-3",children:[a.jsx(ra,{selectedDate:y.date,setSelectedDate:c=>R(v=>({...v,date:c})),selectedMeal:y.meal,setSelectedMeal:c=>R(v=>({...v,meal:c})),selectedUnit:y.unit,setSelectedUnit:c=>R(v=>({...v,unit:c})),dates:u}),a.jsxs("div",{className:"w-full sm:w-auto flex flex-wrap items-center gap-2 sm:justify-end",children:[a.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[a.jsx(rt,{id:"autoClose",checked:i,onCheckedChange:n}),a.jsx(ae,{htmlFor:"autoClose",className:"whitespace-nowrap",children:i?"Fechar Auto.":"Fechar Manual"})]}),a.jsxs(A,{variant:"outline",size:"sm",onClick:z.toggleScan,disabled:!b.hasPermission,className:"shrink-0",children:[a.jsx(St,{className:"h-4 w-4 mr-2"}),b.isScanning?"Pausar":"Ler"]}),a.jsx(A,{variant:"outline",size:"sm",onClick:z.refresh,disabled:!b.hasPermission,className:"shrink-0",children:a.jsx(Ct,{className:`h-4 w-4 ${b.isScanning?"animate-spin":""}`})}),Z&&a.jsx(A,{variant:"secondary",size:"sm",onClick:z.clearResult,className:"shrink-0",children:"Limpar"}),a.jsxs(A,{variant:"default",size:"sm",onClick:ze,disabled:p,className:"shrink-0",children:[a.jsx(aa,{className:"h-4 w-4 mr-2"}),"Outros ",oe?`(${oe})`:""]})]})]}),a.jsxs("div",{className:"qr-reader relative rounded-xl border border-border bg-card text-card-foreground p-3",children:[a.jsx("video",{ref:t,className:"rounded-md w-full max-h-[60vh] object-cover"}),!b.hasPermission&&b.isReady&&a.jsx("div",{className:"mt-3 text-center p-4 border border-border rounded-md bg-destructive/10 text-destructive text-sm",children:a.jsx("p",{children:b.error||"Acesso à câmera negado."})}),a.jsx("div",{ref:r,className:"qr-box pointer-events-none"}),Z&&a.jsxs("p",{className:"absolute top-2 left-2 z-50 rounded px-2 py-1 bg-accent/90 text-accent-foreground text-xs shadow",children:["Último UUID: ",Z]})]}),a.jsx(na,{selectedDate:y.date,selectedMeal:y.meal,presences:Qe,forecastMap:Ge,actions:z}),a.jsx(ia,{setDialog:Y,dialog:S,confirmDialog:X,selectedUnit:y.unit,resolveDisplayName:ga})]})});export{Ja as default,Xa as meta};

import{a as s,w as j,t as b}from"./chunk-OIYGIGL5-BjQr_l_M.js";import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{u as g}from"./auth-provider-Diczkjh1.js";import{c as N}from"./AdminService-CgJGPFg0.js";import{S as v,E as w,M as y}from"./shield-BWJ6xpKI.js";import{C as f}from"./label-DlsFJCEv.js";import{C}from"./chart-column-BHJwCZlW.js";import{Q as k,C as S,D as M}from"./index-BCAIc7o-.js";import{U as z}from"./MessHallSelector-Ddc9UKgG.js";import{Q as O}from"./qr-code-DupRlWHo.js";import{C as E}from"./circle-check-ChEJ_whZ.js";import"./useQuery-DJjewD8N.js";import"./useBaseQuery-CE2J4sU2.js";import"./QueryClientProvider-ChAT3DNt.js";import"./supabase-BHBWl_Zr.js";import"./createLucideIcon-CwMMISn7.js";import"./index-B2a0W2do.js";import"./index-CpAFY4EY.js";import"./index-yifceNX_.js";import"./utils-BEHD0UYf.js";import"./badge-B95kivET.js";import"./useMessHalls-DOz8GpeU.js";import"./index-BsqcEdqH.js";import"./index-BnHrxEV7.js";import"./check-P3aSJU2R.js";function R({error:a}){return e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm border mb-3",children:[e.jsx(v,{}),"Painel Administrativo"]}),e.jsx("h1",{className:"text-3xl md:text-4xl font-boldmb-3",children:"Controles da sua OM"}),e.jsx("p",{className:"max-w-2xl mx-auto",children:"Gere o QR de auto check-in e acompanhe indicadores da unidade em tempo real."}),a&&e.jsxs("div",{className:"mt-4 inline-flex items-center gap-2 rounded-lg border px-4 py-2",role:"alert",children:[e.jsx(f,{className:"h-4 w-4","aria-hidden":"true"}),e.jsx("span",{children:a})]})]})}function U(){const[a,i]=s.useState(!1),l=s.useMemo(()=>"clamp(520px, 78vh, 1000px)",[]),t=()=>i(d=>!d),r="https://app.powerbi.com/view?r=eyJrIjoiOTMwNzQxODYtMjc0OS00Y2U2LThjMWItMTU5MGZkZjk2ZmE3IiwidCI6IjNhMzY0ZGI2LTg2NmEtNDRkOS1iMzY5LWM1ODk1OWQ0NDhmOCJ9";return e.jsxs("div",{className:` rounded-2xl border shadow-sm ${a?"p-0":"p-6"}`,children:[e.jsxs("div",{className:`${a?"px-4 py-3":"mb-4"} flex items-center justify-between`,children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-2.5 py-1 rounded-full text-xs border",children:[e.jsx(C,{className:"h-4 w-4","aria-hidden":"true"}),"Indicadores"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>window.open(r,"_blank","noopener,noreferrer"),className:"inline-flex items-center gap-2 text-xs px-3 py-1.5 rounded-lg border hover:bg-gray-50","aria-label":"Abrir relatório em nova aba",title:"Abrir em nova aba",children:[e.jsx(w,{className:"h-4 w-4","aria-hidden":"true"}),"Abrir"]}),e.jsxs("button",{onClick:t,className:"inline-flex items-center gap-2 text-xs px-3 py-1.5 rounded-lg border hover:bg-gray-50 ","aria-pressed":a,"aria-label":a?"Reduzir":"Expandir",title:a?"Reduzir":"Expandir",children:[e.jsx(y,{className:"h-4 w-4","aria-hidden":"true"}),a?"Reduzir":"Expandir"]})]})]}),e.jsxs("div",{className:a?"":"px-0",children:[e.jsx("div",{className:`${a?"":"px-6"} pb-4 flex flex-col gap-3`,children:!a&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-xl font-bold ",children:"Indicadores da Unidade"}),e.jsx("p",{className:" text-sm",children:"Acompanhe métricas e relatórios consolidados. Expanda para tela cheia para melhor visualização."})]})}),e.jsxs("div",{className:`${a?"":"px-6"} pb-6`,children:[e.jsx("div",{className:"rounded-2xl border  overflow-hidden ",children:e.jsx("iframe",{title:"Indicadores SISUB - Power BI",src:r,className:"w-full",style:{height:l},allowFullScreen:!0,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade"})}),e.jsx("div",{className:"mt-3 text-xs  px-1",children:"Dica: use o botão de tela cheia dentro do relatório para melhor experiência."})]})]})]})}function I({selectedOm:a,onChangeSelectedOm:i,status:l}){const t="https://app.previsaosisub.com.br/checkin",r=a?.trim(),d=s.useMemo(()=>{const c=new URL(t),o=(r??"").normalize("NFKC").trim();return c.searchParams.set("u",o),c.toString()},[t,r]),x=s.useRef(null),[u,m]=s.useState(!1),p=async()=>{try{if(!r)return;await navigator.clipboard.writeText(r),m(!0),setTimeout(()=>m(!1),1500)}catch{alert("Não foi possível copiar a OM.")}},n=()=>{const c=x.current?.querySelector("canvas")??null;if(!c)return;const o=c.toDataURL("image/png"),h=document.createElement("a");h.href=o,h.download=`qr-auto-checkin-${r||"om"}.png`,h.click()};return e.jsxs("div",{className:"rounded-2xl border  shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-2.5 py-1 rounded-full text-xs   border ",children:[e.jsx(O,{className:"h-4 w-4","aria-hidden":"true"}),"Auto Check-In"]}),r?e.jsxs("span",{className:"text-xs ",children:["OM: ",r]}):e.jsx("span",{className:"text-xs ",children:"OM não definida"})]}),e.jsx("h2",{className:"text-xl font-bold  mb-4",children:"QR Code de Auto Check-In"}),e.jsx("div",{className:"mb-4",children:e.jsx(z,{value:a,onChange:i,disabled:l!=="authorized",hasDefaultUnit:!1,showValidation:!0,size:"md",placeholder:"Selecione uma unidade..."})}),e.jsx("div",{className:" text-sm mb-4",children:"Exiba este QR no ponto de acesso. Usuários autorizados farão check-in pela câmera do celular."}),e.jsx("div",{ref:x,className:"flex flex-col items-center justify-center rounded-xl border   p-6",children:r?e.jsx(k,{value:d,size:256,level:"Q",bgColor:"#ffffff",fgColor:"#1f2937","aria-label":"QR code para auto check-in da OM",marginSize:2}):e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-lg border  px-3 py-2 ",role:"status","aria-live":"polite",children:[e.jsx(f,{className:"h-4 w-4","aria-hidden":"true"}),"Defina uma OM para gerar o QR Code."]})}),e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row gap-2",children:[e.jsx("button",{onClick:p,disabled:!r,className:`inline-flex items-center justify-center gap-2 px-4 py-2 rounded-lg font-semibold transition-all duration-150 shadow-sm ${r?" ver:bg-emerald-700":"  cursor-not-allowed"}`,children:u?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-4 w-4","aria-hidden":"true"}),"Copiado"]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-4 w-4","aria-hidden":"true"}),"Copiar OM"]})}),e.jsxs("button",{onClick:n,disabled:!r,className:`inline-flex items-center justify-center gap-2 px-4 py-2 rounded-lg font-semibold transition-all duration-150 border ${r?"border-gray-300   hover:bg-gray-50":"border-gray-200  cursor-not-allowed"}`,children:[e.jsx(M,{className:"h-4 w-4","aria-hidden":"true"}),"Baixar PNG do QR"]})]})]})}function ie({}){return[{title:"Painel Admin"},{name:"description",content:"Controle sua unidade"}]}const ne=j(function(){const{user:i}=g(),[l,t]=s.useState("checking"),[r,d]=s.useState(null),[x,u]=s.useState(""),[m,p]=s.useState(!1);return s.useEffect(()=>{const n=setTimeout(()=>p(!0),10);return()=>clearTimeout(n)},[]),s.useEffect(()=>{let n=!0;return(async()=>{if(i?.id){t("checking"),d(null);try{const o=await N(i.id);if(!n)return;t(o==="admin"||o==="superadmin"?"authorized":"unauthorized")}catch{if(!n)return;d("Não foi possível verificar suas permissões. Tente novamente."),t("unauthorized")}}})(),()=>{n=!1}},[i?.id]),l==="unauthorized"?e.jsx(b,{to:"/rancho",replace:!0}):e.jsxs("div",{className:"min-h-screen ",children:[e.jsx("section",{id:"hero",className:`container mx-auto max-w-screen-2xl px-4 pt-10 md:pt-14 transition-all duration-500 ${m?"opacity-100 translate-y-0":"opacity-0 translate-y-4"}`,children:e.jsx(R,{error:r})}),e.jsx("section",{id:"content",className:`container mx-auto max-w-screen-2xl px-4 py-10 md:py-14 transition-all duration-500 delay-100 ${m?"opacity-100 translate-y-0":"opacity-0 translate-y-4"}`,children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:gap-8",children:[e.jsx(U,{}),e.jsx(I,{selectedOm:x,onChangeSelectedOm:u,status:l})]})})]})});export{ne as default,ie as meta};
